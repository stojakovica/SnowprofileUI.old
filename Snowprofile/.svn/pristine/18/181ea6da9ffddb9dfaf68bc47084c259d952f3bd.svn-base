package at.ac.dbisinformatik.snowprofile.web;

import java.io.IOException;
import java.util.List;
import java.util.Map;

import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;
import org.restlet.representation.Representation;
import org.restlet.representation.StringRepresentation;
import org.restlet.resource.Delete;
import org.restlet.resource.Get;
import org.restlet.resource.Post;
import org.restlet.resource.ServerResource;

import at.ac.dbisinformatik.snowprofile.data.DB;
import at.ac.dbisinformatik.snowprofile.data.SchichtprofilDAO;

import com.orientechnologies.orient.core.record.impl.ODocument;

public class ListSnowProfileResource extends ServerResource {

	private DB db;

	public ListSnowProfileResource(DB db) {
		setNegotiated(true);
		this.db = db;
	}

	@Get()
	public String getJson() throws JSONException, IOException {
		return "{SnowprofileList: " + SchichtprofilDAO.getAllSnowprofiles(db).toString() + "}";
	}

	@Post
	public String storeJson(Representation value) throws IOException, JSONException {
//		UploadFileTO uploadFileTO = (UploadFileTO) command;
//	    List<XmlTO> al=new ArrayList<XmlTO>();
//	    Map<String,String> model = new HashMap<String,String>();
//
//	    MultipartFile file = uploadFileTO.getFile();
		if(value.toString().substring(0,1).equals("<")) {
			return "{ok: true}";
		}
		else {
			return db.store("SnowProfile", new JSONObject(value.getText()));
		}
	}

	@Delete
	protected Representation delete() {
		return new StringRepresentation("{\"success\": \"true\"}");
	}
}
